{
  "suite": "core_strings",
  "cases": [
    {
      "name": "ping",
      "now_ms": 0,
      "argv": ["PING"],
      "expect": { "kind": "simple", "value": "PONG" }
    },
    {
      "name": "set_foo",
      "now_ms": 10,
      "argv": ["SET", "foo", "bar"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "get_foo",
      "now_ms": 10,
      "argv": ["GET", "foo"],
      "expect": { "kind": "bulk", "value": "bar" }
    },
    {
      "name": "incr_counter_1",
      "now_ms": 20,
      "argv": ["INCR", "counter"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "incr_counter_2",
      "now_ms": 20,
      "argv": ["INCR", "counter"],
      "expect": { "kind": "integer", "value": 2 }
    },
    {
      "name": "expire_foo",
      "now_ms": 1000,
      "argv": ["EXPIRE", "foo", "1"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pttl_foo_not_expired",
      "now_ms": 1000,
      "argv": ["PTTL", "foo"],
      "expect": { "kind": "integer", "value": 1000 }
    },
    {
      "name": "foo_expires",
      "now_ms": 2001,
      "argv": ["GET", "foo"],
      "expect": { "kind": "bulk", "value": null }
    },
    {
      "name": "pttl_foo_missing",
      "now_ms": 2001,
      "argv": ["PTTL", "foo"],
      "expect": { "kind": "integer", "value": -2 }
    },
    {
      "name": "set_px",
      "now_ms": 3000,
      "argv": ["SET", "ephemeral", "v", "PX", "20"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "pttl_ephemeral",
      "now_ms": 3000,
      "argv": ["PTTL", "ephemeral"],
      "expect": { "kind": "integer", "value": 20 }
    },
    {
      "name": "ephemeral_expired",
      "now_ms": 3021,
      "argv": ["GET", "ephemeral"],
      "expect": { "kind": "bulk", "value": null }
    },
    {
      "name": "set_expire_options_key",
      "now_ms": 3100,
      "argv": ["SET", "optkey", "v"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "expire_nx_initial",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "10", "NX"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "expire_nx_reject_existing_ttl",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "20", "NX"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "expire_xx_accept_existing_ttl",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "20", "XX"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "expire_gt_reject_smaller_deadline",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "15", "GT"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "expire_gt_accept_larger_deadline",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "25", "GT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "expire_lt_reject_larger_deadline",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "30", "LT"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "expire_lt_accept_smaller_deadline",
      "now_ms": 3100,
      "argv": ["EXPIRE", "optkey", "5", "LT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "set_persistent_expire_options_key",
      "now_ms": 3200,
      "argv": ["SET", "persistent", "v"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "expire_xx_rejects_no_ttl",
      "now_ms": 3200,
      "argv": ["EXPIRE", "persistent", "5", "XX"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "expire_gt_rejects_no_ttl",
      "now_ms": 3200,
      "argv": ["EXPIRE", "persistent", "5", "GT"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "expire_lt_accepts_no_ttl",
      "now_ms": 3200,
      "argv": ["EXPIRE", "persistent", "5", "LT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "set_abskey",
      "now_ms": 3300,
      "argv": ["SET", "abskey", "v"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "pexpire_abskey",
      "now_ms": 3300,
      "argv": ["PEXPIRE", "abskey", "250"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pttl_abskey",
      "now_ms": 3300,
      "argv": ["PTTL", "abskey"],
      "expect": { "kind": "integer", "value": 250 }
    },
    {
      "name": "pexpiretime_abskey",
      "now_ms": 3300,
      "argv": ["PEXPIRETIME", "abskey"],
      "expect": { "kind": "integer", "value": 3550 }
    },
    {
      "name": "expiretime_abskey",
      "now_ms": 3300,
      "argv": ["EXPIRETIME", "abskey"],
      "expect": { "kind": "integer", "value": 3 }
    },
    {
      "name": "abskey_expired",
      "now_ms": 3551,
      "argv": ["GET", "abskey"],
      "expect": { "kind": "bulk", "value": null }
    },
    {
      "name": "set_whenkey",
      "now_ms": 3600,
      "argv": ["SET", "whenkey", "v"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "expireat_whenkey",
      "now_ms": 3600,
      "argv": ["EXPIREAT", "whenkey", "6"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pttl_whenkey_after_expireat",
      "now_ms": 3600,
      "argv": ["PTTL", "whenkey"],
      "expect": { "kind": "integer", "value": 2400 }
    },
    {
      "name": "pexpireat_whenkey",
      "now_ms": 3600,
      "argv": ["PEXPIREAT", "whenkey", "7000"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pttl_whenkey_after_pexpireat",
      "now_ms": 3600,
      "argv": ["PTTL", "whenkey"],
      "expect": { "kind": "integer", "value": 3400 }
    },
    {
      "name": "expiretime_whenkey",
      "now_ms": 3600,
      "argv": ["EXPIRETIME", "whenkey"],
      "expect": { "kind": "integer", "value": 7 }
    },
    {
      "name": "set_poptkey",
      "now_ms": 3700,
      "argv": ["SET", "poptkey", "v"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "pexpire_nx_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "1000", "NX"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pexpire_gt_accept_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "1500", "GT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pexpire_gt_reject_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "1200", "GT"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "pexpire_xx_gt_accept_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "2000", "XX", "GT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pexpire_xx_lt_accept_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "1000", "XX", "LT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "pexpire_xx_lt_reject_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "1500", "XX", "LT"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "pexpire_lt_accept_poptkey",
      "now_ms": 3700,
      "argv": ["PEXPIRE", "poptkey", "500", "LT"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "set_nx_new_key",
      "now_ms": 4000,
      "argv": ["SET", "nxkey", "val", "NX"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "set_nx_existing_key",
      "now_ms": 4000,
      "argv": ["SET", "nxkey", "other", "NX"],
      "expect": { "kind": "bulk", "value": null }
    },
    {
      "name": "set_nx_verify_unchanged",
      "now_ms": 4000,
      "argv": ["GET", "nxkey"],
      "expect": { "kind": "bulk", "value": "val" }
    },
    {
      "name": "set_xx_existing",
      "now_ms": 4000,
      "argv": ["SET", "nxkey", "updated", "XX"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "set_xx_missing",
      "now_ms": 4000,
      "argv": ["SET", "xxmissing", "v", "XX"],
      "expect": { "kind": "bulk", "value": null }
    },
    {
      "name": "set_get_returns_old",
      "now_ms": 4000,
      "argv": ["SET", "nxkey", "final", "GET"],
      "expect": { "kind": "bulk", "value": "updated" }
    },
    {
      "name": "set_get_verify",
      "now_ms": 4000,
      "argv": ["GET", "nxkey"],
      "expect": { "kind": "bulk", "value": "final" }
    },
    {
      "name": "set_get_missing_key",
      "now_ms": 4000,
      "argv": ["SET", "sgmissing", "v", "GET"],
      "expect": { "kind": "bulk", "value": null }
    },
    {
      "name": "set_keepttl_setup",
      "now_ms": 4000,
      "argv": ["SET", "keepkey", "v", "EX", "100"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "set_keepttl",
      "now_ms": 4000,
      "argv": ["SET", "keepkey", "newv", "KEEPTTL"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "set_keepttl_verify_value",
      "now_ms": 4000,
      "argv": ["GET", "keepkey"],
      "expect": { "kind": "bulk", "value": "newv" }
    },
    {
      "name": "set_keepttl_verify_ttl",
      "now_ms": 4000,
      "argv": ["TTL", "keepkey"],
      "expect": { "kind": "integer", "value": 100 }
    },
    {
      "name": "mset_multi",
      "now_ms": 4100,
      "argv": ["MSET", "mk1", "mv1", "mk2", "mv2", "mk3", "mv3"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "mget_multi",
      "now_ms": 4100,
      "argv": ["MGET", "mk1", "mk2", "nokey", "mk3"],
      "expect": {
        "kind": "array",
        "value": [
          { "kind": "bulk", "value": "mv1" },
          { "kind": "bulk", "value": "mv2" },
          { "kind": "bulk", "value": null },
          { "kind": "bulk", "value": "mv3" }
        ]
      }
    },
    {
      "name": "msetnx_all_new",
      "now_ms": 4100,
      "argv": ["MSETNX", "mn1", "v1", "mn2", "v2"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "msetnx_one_exists",
      "now_ms": 4100,
      "argv": ["MSETNX", "mn1", "other", "mn3", "v3"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "msetnx_verify_unchanged",
      "now_ms": 4100,
      "argv": ["GET", "mn1"],
      "expect": { "kind": "bulk", "value": "v1" }
    },
    {
      "name": "msetnx_verify_mn3_not_set",
      "now_ms": 4100,
      "argv": ["EXISTS", "mn3"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "incrbyfloat_new_key",
      "now_ms": 4200,
      "argv": ["INCRBYFLOAT", "flt", "3.14"],
      "expect": { "kind": "bulk", "value": "3.14" }
    },
    {
      "name": "incrbyfloat_add",
      "now_ms": 4200,
      "argv": ["INCRBYFLOAT", "flt", "0.86"],
      "expect": { "kind": "bulk", "value": "4" }
    },
    {
      "name": "incrbyfloat_negative",
      "now_ms": 4200,
      "argv": ["INCRBYFLOAT", "flt", "-1.5"],
      "expect": { "kind": "bulk", "value": "2.5" }
    },
    {
      "name": "decrby_new_key",
      "now_ms": 4200,
      "argv": ["DECRBY", "deckey", "5"],
      "expect": { "kind": "integer", "value": -5 }
    },
    {
      "name": "decrby_existing",
      "now_ms": 4200,
      "argv": ["DECRBY", "deckey", "3"],
      "expect": { "kind": "integer", "value": -8 }
    },
    {
      "name": "strlen_existing",
      "now_ms": 4300,
      "argv": ["STRLEN", "mk1"],
      "expect": { "kind": "integer", "value": 3 }
    },
    {
      "name": "strlen_missing",
      "now_ms": 4300,
      "argv": ["STRLEN", "nokey"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "setrange_extend",
      "now_ms": 4300,
      "argv": ["SETRANGE", "srkey", "6", "Redis"],
      "expect": { "kind": "integer", "value": 11 }
    },
    {
      "name": "getrange_result",
      "now_ms": 4300,
      "argv": ["GETRANGE", "srkey", "6", "10"],
      "expect": { "kind": "bulk", "value": "Redis" }
    },
    {
      "name": "getrange_zero_prefix",
      "now_ms": 4300,
      "argv": ["GETRANGE", "srkey", "0", "5"],
      "expect": { "kind": "bulk", "value": "\u0000\u0000\u0000\u0000\u0000\u0000" }
    },
    {
      "name": "setnx_new_key",
      "now_ms": 4400,
      "argv": ["SETNX", "snxkey", "hello"],
      "expect": { "kind": "integer", "value": 1 }
    },
    {
      "name": "setnx_existing",
      "now_ms": 4400,
      "argv": ["SETNX", "snxkey", "world"],
      "expect": { "kind": "integer", "value": 0 }
    },
    {
      "name": "setnx_verify",
      "now_ms": 4400,
      "argv": ["GET", "snxkey"],
      "expect": { "kind": "bulk", "value": "hello" }
    },
    {
      "name": "setex_ok",
      "now_ms": 4500,
      "argv": ["SETEX", "sexkey", "10", "val"],
      "expect": { "kind": "simple", "value": "OK" }
    },
    {
      "name": "setex_verify_value",
      "now_ms": 4500,
      "argv": ["GET", "sexkey"],
      "expect": { "kind": "bulk", "value": "val" }
    },
    {
      "name": "setex_verify_ttl",
      "now_ms": 4500,
      "argv": ["TTL", "sexkey"],
      "expect": { "kind": "integer", "value": 10 }
    },
    {
      "name": "getset_existing",
      "now_ms": 4600,
      "argv": ["GETSET", "snxkey", "newval"],
      "expect": { "kind": "bulk", "value": "hello" }
    },
    {
      "name": "getset_verify",
      "now_ms": 4600,
      "argv": ["GET", "snxkey"],
      "expect": { "kind": "bulk", "value": "newval" }
    },
    {
      "name": "getset_missing",
      "now_ms": 4600,
      "argv": ["GETSET", "gsmissing", "v"],
      "expect": { "kind": "bulk", "value": null }
    },
    {
      "name": "incr_on_non_integer",
      "now_ms": 4700,
      "argv": ["INCR", "mk1"],
      "expect": { "kind": "error", "value": "ERR value is not an integer or out of range" }
    },
    {
      "name": "unknown_command",
      "now_ms": 5000,
      "argv": ["NOPE"],
      "expect": { "kind": "error", "value": "ERR unknown command 'NOPE'" }
    },
    {
      "name": "wrong_arity",
      "now_ms": 5001,
      "argv": ["GET"],
      "expect": { "kind": "error", "value": "ERR wrong number of arguments for 'GET' command" }
    }
  ]
}
